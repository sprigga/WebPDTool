# case_type ç¨‹å¼ç¢¼è·¯å¾‘è¿½è¹¤åˆ†æå ±å‘Š

## æ—¥æœŸ: 2026-02-10

## åˆ†æç›®æ¨™
è¿½è¹¤ `case_type` æ¬„ä½åœ¨æ•´å€‹ç¨‹å¼ç¢¼åº«ä¸­çš„å®Œæ•´ä½¿ç”¨è·¯å¾‘ï¼Œä»¥è©•ä¼°æ¬„ä½åˆä½µé‡æ§‹çš„å½±éŸ¿ç¯„åœã€‚

## é‡æ§‹èƒŒæ™¯

æ ¹æ“š `merge-case-type-to-switch-mode.md` çš„é‡æ§‹æ–¹æ¡ˆï¼š
- `case_type` åŠŸèƒ½å·²åˆä½µåˆ° `switch_mode`ï¼ˆå„€å™¨æ¨¡å¼ï¼‰
- ç›®çš„ï¼šé¿å…æ¬„ä½é‡è¤‡å’Œé‚è¼¯æ··äº‚
- ä¿ç•™ `case_type` æ¬„ä½ä»¥æ”¯æ´ CSV åŒ¯å…¥å‘å¾Œç›¸å®¹

---

## ğŸ“Š ç¨‹å¼ç¢¼è·¯å¾‘åˆ†æ

### 1. å‰ç«¯å±¤ - TestPlanManage.vue

| è¡Œæ•¸ | ç¨‹å¼ç¢¼ | ç‹€æ…‹ | èªªæ˜ |
|------|--------|------|------|
| 121 | `<el-table-column prop="case_type" label="æ¡ˆä¾‹é¡å‹" />` | ğŸ”´ ä¿ç•™ | è¡¨æ ¼é¡¯ç¤ºæ¬„ä½ |
| 347-349 | `<!-- ä¿®æ­£æ–¹æ¡ˆ A: ç§»é™¤ execute_name å’Œ case_type -->` | ğŸŸ¢ å·²ç§»é™¤ | ç·¨è¼¯è¡¨å–®å·²ç§»é™¤ |
| 597 | `case_type: ''` | ğŸ”´ ä¿ç•™ | editingItem åˆå§‹åŒ– |
| 864 | `case_type: ''` | ğŸ”´ ä¿ç•™ | handleAddItem é‡ç½® |
| 927 | `case_type: editingItem.case_type` | ğŸ”´ ä¿ç•™ | å„²å­˜æ™‚å‚³é€ |

**UI é¡¯ç¤º:**
```vue
<!-- ç¬¬ 121 è¡Œ - è¡¨æ ¼é¡¯ç¤º -->
<el-table-column prop="case_type" label="æ¡ˆä¾‹é¡å‹" width="100" />
```

**è¡¨å–®è¨»è§£:**
```vue
<!-- ç¬¬ 347-349 è¡Œ -->
<!-- ä¿®æ­£æ–¹æ¡ˆ A: ç§»é™¤ execute_name å’Œ case_type,çµ±ä¸€ä½¿ç”¨ switch_mode (å„€å™¨æ¨¡å¼) -->
<!-- case_type åŠŸèƒ½å·²åˆä½µåˆ° switch_mode,é¿å…æ¬„ä½é‡è¤‡å’Œé‚è¼¯æ··äº‚ -->
<!-- è³‡æ–™åº«ä¿ç•™ case_type æ¬„ä½ä»¥æ”¯æ´ CSV åŒ¯å…¥å‘å¾Œç›¸å®¹ -->
```

---

### 2. å‰ç«¯å±¤ - TestMain.vue

| è¡Œæ•¸ | ç¨‹å¼ç¢¼ | ç”¨é€” |
|------|--------|------|
| 1006-1008 | `const switchMode = item.switch_mode \|\| item.case_type \|\| ...` | å‘å¾Œç›¸å®¹é‚è¼¯ |

**å‘å¾Œç›¸å®¹ç¨‹å¼ç¢¼:**
```javascript
// ç¬¬ 1006-1008 è¡Œ
// åŸæœ‰ç¨‹å¼ç¢¼: å„ªå…ˆä½¿ç”¨ case_type
// ä¿®æ­£æ–¹æ¡ˆ A: å„ªå…ˆä½¿ç”¨ switch_mode,å‘å¾Œç›¸å®¹ case_type
const switchMode = item.switch_mode || item.case_type || item.case || item.item_name
```

---

### 3. å¾Œç«¯ API å±¤

#### Schema å®šç¾© (`backend/app/schemas/testplan.py`)
| è¡Œæ•¸ | ç¨‹å¼ç¢¼ |
|------|--------|
| 33 | `case_type: Optional[str] = Field(default=None)` |
| 65 | `case_type: Optional[str] = None` |

#### Model å®šç¾© (`backend/app/models/testplan.py`)
| è¡Œæ•¸ | ç¨‹å¼ç¢¼ |
|------|--------|
| 39 | `case_type = Column(String(50), nullable=True)` |

---

### 4. å¾Œç«¯æœå‹™å±¤

#### TestEngine (`backend/app/services/test_engine.py`)
| è¡Œæ•¸ | ç¨‹å¼ç¢¼ | ç”¨é€” |
|------|--------|------|
| 220-223 | `switch_mode = test_plan_item.switch_mode or test_plan_item.case_type` | å‘å¾Œç›¸å®¹åˆ¤æ–· |
| 248-249 | `"switch_mode": switch_mode, "case_type": test_plan_item.case_type` | ä¿ç•™å‚³é |

**ç¨‹å¼ç¢¼:**
```python
# ç¬¬ 220-223 è¡Œ
# åŸæœ‰ç¨‹å¼ç¢¼: ä½¿ç”¨ case_type ä¾†æ±ºå®šç‰¹æ®Šæ¸¬è©¦é¡å‹
# ä¿®æ­£æ–¹æ¡ˆ A: çµ±ä¸€ä½¿ç”¨ switch_mode æ›¿ä»£ case_type,ç°¡åŒ–é‚è¼¯
switch_mode = test_plan_item.switch_mode or test_plan_item.case_type  # å‘å¾Œç›¸å®¹
special_switch_modes = {'wait', 'relay', 'chassis_rotation', 'console', 'comport', 'tcpip'}
```

---

#### MeasurementService (`backend/app/services/measurement_service.py`)
| è¡Œæ•¸ | ç¨‹å¼ç¢¼ | ç”¨é€” |
|------|--------|------|
| 458 | `# æ–°å¢: æ”¯æ´ measurement_type='command' (å°æ‡‰ case_type='command')` | è¨»è§£èªªæ˜ |
| 467 | `# æ–°å¢: ç›´æ¥æ”¯æ´ case_type ä½œç‚º measurement_type` | è¨»è§£èªªæ˜ |
| 594 | `# æ“´å±•æ”¯æ´çš„æ¸¬é‡é¡å‹ (åŒ…æ‹¬ case_type ç›´æ¥ä½œç‚º measurement_type çš„æƒ…æ³)` | è¨»è§£èªªæ˜ |

---

#### Implementations (`backend/app/measurements/implementations.py`)
| è¡Œæ•¸ | ç¨‹å¼ç¢¼ | ç”¨é€” |
|------|--------|------|
| 71-94 | `OtherMeasurement` é¡åˆ¥ä¸­çš„è…³æœ¬åç¨±è§£æ | å‘å¾Œç›¸å®¹é‚è¼¯ |

**ç¨‹å¼ç¢¼:**
```python
# ç¬¬ 83-87 è¡Œ
# Maps switch_mode (case_type) to script files:
# åŸæœ‰ç¨‹å¼ç¢¼: å„ªå…ˆä½¿ç”¨ case_type
# æ–°å¯¦ä½œ: switch_mode -> case_type -> item_name (å‘å¾Œç›¸å®¹)
switch_mode = (
    self.test_plan_item.get("switch_mode", "") or
    self.test_plan_item.get("case_type", "") or
    self.test_plan_item.get("item_name", "")
).strip()
```

---

### 5. CSV åŒ¯å…¥å±¤

#### CSV Parser (`backend/app/utils/csv_parser.py`)
| è¡Œæ•¸ | ç¨‹å¼ç¢¼ |
|------|--------|
| 164 | `'case_type': csv_row.case if csv_row.case else None` |

#### Import Script (`backend/scripts/import_testplan.py`)
| è¡Œæ•¸ | ç¨‹å¼ç¢¼ |
|------|--------|
| 102 | `'case_type': safe_str(row.get('case'))` |
| 238 | `case_type=data['case_type']` |

---

### 6. è³‡æ–™åº«å±¤

#### Migration (`backend/alembic/versions/0232af89acc2_add_new_fields_to_testplan_table.py`)
| è¡Œæ•¸ | ç¨‹å¼ç¢¼ |
|------|--------|
| 68 | `op.add_column('test_plans', sa.Column('case_type', ...))` |
| 123 | `op.drop_column('test_plans', 'case_type')` |

#### Migration SQL (`backend/scripts/migrate_case_type_to_switch_mode.sql`)
```sql
UPDATE test_plans
SET switch_mode = case_type
WHERE (switch_mode IS NULL OR switch_mode = '')
  AND case_type IS NOT NULL
  AND case_type != '';
```

---

## ğŸ”„ è³‡æ–™æµå‘åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CSV åŒ¯å…¥å±¤                                â”‚
â”‚  CSV æª”æ¡ˆ (case æ¬„ä½) â†’ csv_parser.py â†’ case_type               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        è³‡æ–™åº«å±¤                                  â”‚
â”‚  test_plans.case_type (VARCHAR(50))                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯å±¤                                    â”‚
â”‚  TestPlanManage.vue (è¡¨æ ¼é¡¯ç¤º case_type)                        â”‚
â”‚  TestMain.vue (è®€å–ä¸¦è½‰æ›ç‚º switch_mode)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å¾Œç«¯ API å±¤                               â”‚
â”‚  API Schema (case_type: Optional[str])                          â”‚
â”‚  API Request/Response (ä¿ç•™ case_type)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å¾Œç«¯æœå‹™å±¤                                â”‚
â”‚  test_engine.py (å„ªå…ˆ switch_mode,å¾Œå‚™ case_type)               â”‚
â”‚  implementations.py (è…³æœ¬åç¨±è§£æ)                               â”‚
â”‚  measurement_service.py (æ”¯æ´ case_type ä½œç‚ºæ¸¬é‡é¡å‹)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ æª”æ¡ˆä½¿ç”¨æ¸…å–®

### å‰ç«¯æª”æ¡ˆ
| æª”æ¡ˆ | è¡Œæ•¸ | ä½¿ç”¨æ¬¡æ•¸ | ç‹€æ…‹ |
|------|------|----------|------|
| `TestPlanManage.vue` | 121, 347-349, 597, 864, 927 | 5 | ğŸ”´ é¡¯ç¤ºä¿ç•™ï¼Œè¼¸å…¥å·²ç§»é™¤ |
| `TestMain.vue` | 1006-1008 | 1 | ğŸ”´ å‘å¾Œç›¸å®¹é‚è¼¯ |

### å¾Œç«¯æª”æ¡ˆ
| æª”æ¡ˆ | è¡Œæ•¸ | ä½¿ç”¨æ¬¡æ•¸ | ç‹€æ…‹ |
|------|------|----------|------|
| `testplan.py` (Schema) | 33, 65 | 2 | ğŸ”´ ä¿ç•™ |
| `testplan.py` (Model) | 39 | 1 | ğŸ”´ ä¿ç•™ |
| `test_engine.py` | 220-223, 248-249 | 2 | ğŸŸ¡ å‘å¾Œç›¸å®¹ |
| `measurement_service.py` | 458, 467, 594 | 3 | ğŸŸ¡ è¨»è§£èªªæ˜ |
| `implementations.py` | 71-94 | 1 | ğŸŸ¡ å‘å¾Œç›¸å®¹ |
| `csv_parser.py` | 164 | 1 | ğŸ”´ ä¿ç•™ |
| `import_testplan.py` | 102, 238 | 2 | ğŸ”´ ä¿ç•™ |

### è³‡æ–™åº«æª”æ¡ˆ
| æª”æ¡ˆ | è¡Œæ•¸ | ç‹€æ…‹ |
|------|------|------|
| `0232af89acc2_*.py` (Migration) | 68, 123 | ğŸ”´ æ¬„ä½å­˜åœ¨ |
| `migrate_case_type_to_switch_mode.sql` | - | âœ… é·ç§»å®Œæˆ |

---

## âœ… ç•¶å‰ç‹€æ…‹ç¸½çµ

| å±¤ç´š | ç‹€æ…‹ | èªªæ˜ |
|------|------|------|
| **UI é¡¯ç¤º** | ğŸ”´ ä¿ç•™ | TestPlanManage è¡¨æ ¼ä»é¡¯ç¤º |
| **UI è¼¸å…¥** | ğŸŸ¢ å·²ç§»é™¤ | ç·¨è¼¯è¡¨å–®å·²ç§»é™¤ï¼Œçµ±ä¸€ä½¿ç”¨ switch_mode |
| **è³‡æ–™åº«** | ğŸ”´ ä¿ç•™ | case_type æ¬„ä½å­˜åœ¨ |
| **å¾Œç«¯é‚è¼¯** | ğŸŸ¡ å‘å¾Œç›¸å®¹ | å„ªå…ˆ switch_modeï¼Œå¾Œå‚™ case_type |
| **CSV åŒ¯å…¥** | ğŸ”´ ä¿ç•™ | ä»æ”¯æ´ case æ¬„ä½ |

---

## ğŸ¯ å„ªå…ˆé †åºé‚è¼¯

### å‰ç«¯ (TestMain.vue)
```javascript
switch_mode â†’ case_type â†’ case â†’ item_name
```

### å¾Œç«¯ (implementations.py)
```python
switch_mode â†’ case_type â†’ item_name
```

### å¾Œç«¯ (test_engine.py)
```python
switch_mode || case_type
```

---

## ğŸ“ å»ºè­°

### å®Œå…¨ç§»é™¤ case_type çš„æ­¥é©Ÿ

å¦‚æœéœ€è¦å®Œå…¨ç§»é™¤ `case_type`ï¼Œå»ºè­°æŒ‰ä»¥ä¸‹é †åºï¼š

1. **å‰ç«¯**
   - [ ] ç§»é™¤ TestPlanManage.vue è¡¨æ ¼é¡¯ç¤º (ç¬¬ 121 è¡Œ)
   - [ ] ç§»é™¤ TestMain.vue å‘å¾Œç›¸å®¹é‚è¼¯ (ç¬¬ 1006-1008 è¡Œ)

2. **å¾Œç«¯**
   - [ ] æ›´æ–° test_engine.py ç§»é™¤ case_type fallback
   - [ ] æ›´æ–° implementations.py ç§»é™¤ case_type è§£æ
   - [ ] æ›´æ–° measurement_service.py ç§»é™¤ç›¸é—œè¨»è§£

3. **è³‡æ–™åº«**
   - [ ] ç¢ºä¿æ‰€æœ‰ case_type å·²é·ç§»åˆ° switch_mode
   - [ ] åŸ·è¡Œè³‡æ–™æ¸…ç†è…³æœ¬
   - [ ] å»ºç«‹ migration ç§»é™¤ case_type æ¬„ä½

4. **API**
   - [ ] å¾ Schema ç§»é™¤ case_type
   - [ ] æ›´æ–° API æ–‡ä»¶

5. **CSV**
   - [ ] æ›´æ–° CSV åŒ¯å…¥æ–‡ä»¶èªªæ˜
   - [ ] æ›´æ–° csv_parser.py ç§»é™¤ case æ¬„ä½è™•ç†

---

## ğŸ”— ç›¸é—œæ–‡ä»¶

- [merge-case-type-to-switch-mode.md](../refactoring/field-merging/merge-case-type-to-switch-mode.md) - é‡æ§‹å¯¦æ–½å ±å‘Š
- [field-usage-analysis.md](./field-usage-analysis.md) - æ¬„ä½ä½¿ç”¨åˆ†æ

---

**å ±å‘Šå®Œæˆæ—¥æœŸ**: 2026-02-10
**åˆ†æç¯„åœ**: å‰ç«¯ã€å¾Œç«¯ã€è³‡æ–™åº«ã€CSV åŒ¯å…¥
**æª”æ¡ˆæ•¸é‡**: 14 å€‹æª”æ¡ˆ
**ç¨‹å¼ç¢¼ä½ç½®**: 26 è™•
